from common import *
import pytesseract
import cv2 as cv
from ocr3 import *
from PIL import ImageFont, ImageDraw, Image

frame = [0, 199, 230, 236, 242, 248, 254, 261, 285, 291, 297, 304, 310, 328, 334, 340, 346, 352, 370, 376, 382, 389, 395, 407, 413, 431, 437, 444, 450, 456, 474, 480, 511, 517, 546, 547, 564, 570, 576, 582, 601, 607, 619, 625, 631, 638, 644, 662, 668, 674, 680, 686, 704, 710, 716, 723, 729, 753, 760, 766, 772, 778, 784, 815, 834, 917, 947, 953, 959, 965, 972, 978, 1002, 1008, 1015, 1021, 1027, 1045, 1051, 1057, 1063, 1069, 1087, 1093, 1099, 1106, 1112, 1124, 1130, 1148, 1154, 1160, 1166, 1173, 1191, 1197, 1227, 1234, 1240, 1246, 1252, 1258, 1264, 1270, 1276, 1289, 1295, 1301, 1307, 1313, 1319, 1325, 1344, 1368, 1375, 1381, 1387, 1393, 1399, 1405, 1411, 1417, 1423, 1429, 1435, 1442, 1448, 1454, 1460, 1466, 1479, 1485, 1491, 1497, 1503, 1509, 1515, 1521, 1533, 1545, 1571, 1602, 1608, 1620, 1626, 1633, 1640, 1647, 1654, 1661, 1668, 1675, 1681, 1688, 1695, 1702, 1709, 1716, 1741, 1748, 1790, 1797, 1817, 1824, 1831, 1837, 1844, 1851, 1858, 1864, 1871, 1878, 1885, 1891, 1898, 1905, 1912, 1919, 1925, 1932, 1939, 1946, 1952, 1959, 1972, 1979, 1992, 1998, 2010, 2024, 2031, 2045, 2052, 2059, 2065, 2071, 2078, 2085, 2092, 2099, 2105, 2112, 2119, 2126, 2133, 2139, 2146, 2153, 2160, 2166, 2172, 2179, 2199, 2206, 2213, 2233, 2240, 2254, 2267, 2274, 2315, 2322, 2336, 2362, 2369, 2376, 2383, 2389, 2396, 2403, 2411, 2415, 2422, 2435, 2442, 2449, 2463, 2469, 2483, 2489, 2503, 2510, 2516, 2522, 2528, 2534, 2540, 2547, 2554, 2560, 2573, 2587, 2600, 2634, 2641, 2647, 2653, 2659, 2665, 2671, 2677, 2683, 2725, 2731, 2743, 2750, 2768, 2786, 2805, 2835, 2841, 2847, 2853, 2860, 2866, 2872, 2879, 2885, 2891, 2897, 2903, 2909, 2915, 2921, 2927, 2945, 2995, 3013, 3019, 3043, 3049, 3055, 3061, 3067, 3073, 3080, 3086, 3092, 3098, 3104, 3110, 3116, 3122, 3128, 3134, 3158, 3164, 3176, 3201, 3219, 3225, 3231, 3237, 3244, 3250, 3256, 3262, 3268, 3274, 3280, 3286, 3292, 3298, 3304, 3316, 3322, 3328, 3353, 3407, 3413, 3426, 3432, 3438, 3456, 3462, 3468, 3474, 3480, 3486, 3492, 3498, 3504, 3510, 3517, 3523, 3535, 3541, 3565, 3577, 3589, 3601, 3607, 3620, 3632, 3638, 3644, 3650, 3656, 3662, 3668, 3711, 3717, 3723, 3730, 3737, 3743, 3750, 3757, 3764, 3771, 3778, 3785, 3792, 3799, 3805, 3812, 3819, 3826, 3833, 3840, 3847, 3854, 3861, 3867, 3874, 3881, 3888, 3895, 3916, 3936, 3957, 3964, 3977, 3985, 3991, 4012, 4032, 4039, 4047, 4059, 4073, 4080, 4087, 4101, 4108, 4114, 4121, 4156, 4163, 4183, 4197, 4203, 4209, 4215, 4221, 4228, 4234, 4240, 4252, 4258, 4264, 4270, 4276, 4300, 4306, 4312, 4319, 4326, 4333, 4339, 4345, 4352, 4359, 4366, 4373, 4380, 4387, 4394, 4401, 4407, 4414, 4421, 4428, 4435, 4442, 4449, 4456, 4463, 4469, 4476, 4483, 4490, 4497, 4511, 4518, 4538, 4545, 4552, 4573, 4580, 4587, 4607, 4621, 4628, 4642, 4649, 4676, 4690, 4730, 4737, 4765, 4772, 4778, 4785, 4792, 4813, 4834, 4840, 4875, 4881, 4887, 4893, 4899, 4905, 4911, 4917, 4929, 4941, 4948, 4960, 4978, 4990, 4996, 5002, 5008, 5014, 5021, 5027, 5033, 5039, 5051, 5057, 5063, 5069, 5075, 5081, 5087, 5093, 5099, 5105, 5112, 5118, 5124, 5130, 5148, 5154, 5160, 5191, 5197, 5203, 5209, 5247, 5254, 5268, 5275, 5295, 5302, 5316, 5337, 5344, 5350, 5364, 5385, 5406, 5412, 5419, 5433, 5440, 5447, 5468, 5474, 5495, 5523, 5530, 5536, 5543, 5550, 5557, 5563, 5570, 5576, 5583, 5589, 5596, 5602, 5609, 5616, 5622, 5628, 5634, 5641, 5648, 5654, 5661, 5668, 5675, 5682, 5689, 5696, 5703, 5716, 5744, 5751, 5757, 5789, 5796, 5803, 5841, 5854, 5874, 5881, 5900, 5906, 5913, 5919, 5926, 5932, 5938, 5944, 5951, 5958, 5964, 5970, 5977, 5984, 5991, 5997, 6004, 6010, 6017, 6024, 6030, 6037, 6044, 6065, 6078, 6085, 6106, 6112, 6138, 6152, 6172, 6179, 6185, 6198, 6204, 6217, 6224, 6231, 6238, 6245, 6251, 6258, 6265, 6272, 6279, 6286, 6293, 6299, 6313, 6319, 6325, 6346, 6352, 6378, 6385, 6392, 6399, 6405, 6412, 6424, 6431, 6437, 6444, 6450, 6457, 6463, 6470, 6477, 6484, 6490, 6503, 6523, 6530, 6537, 6543, 6549, 6556, 6562, 6568, 6575, 6581, 6588, 6595, 6602, 6609, 6615, 6622, 6628, 6634, 6654, 6667, 6673, 6686, 6699, 6706, 6712, 6719, 6726, 6733, 6739, 6745, 6752, 6758, 6764, 6771, 6777, 6784, 6790, 6803, 6817, 6824, 6830, 6836, 6855, 6868, 6889, 6896, 6908, 6915, 6921, 6927, 6934, 6941, 6947, 6953, 6960, 6966, 6973, 6979, 6985, 6992, 7013, 7026, 7033, 7040, 7053, 7066, 7072, 7078, 7085, 7091, 7111, 7137, 7150, 7162, 7168, 7175, 7181, 7187, 7193, 7200, 7207, 7221, 7227, 7234, 7241, 7254, 7261, 7267, 7274, 7280, 7286, 7293, 7299, 7306, 7313, 7319, 7326, 7332, 7339, 7345, 7352, 7359, 7365, 7371, 7378, 7384, 7391, 7398, 7404, 7410, 7417, 7430, 7443, 7450, 7470, 7503, 7528, 7554, 7606, 7633, 7645, 7652, 7677, 7684, 7690, 7697, 7703, 7710, 7717, 7737, 7744, 7750, 7756, 7763, 7770, 7776, 7782, 7789, 7796, 7802, 7809, 7815, 7834, 7840, 7872, 7878, 7892, 7905, 7917, 7924, 7930, 7943, 7963, 7970, 7977, 7983, 7989, 7996, 8003, 8009, 8015, 8022, 8028, 8034, 8041, 8047, 8054, 8060, 8067, 8073, 8080, 8086, 8093, 8099, 8105, 8112, 8118, 8138, 8145, 8152, 8158, 8165, 8171, 8192, 8198, 8205, 8212, 8218, 8238, 8244, 8250, 8283, 8290, 8296, 8329, 8348, 8361, 8367, 8374, 8381, 8388, 8395, 8401, 8408, 8415, 8422, 8428, 8435, 8442, 8449, 8456, 8462, 8469, 8475, 8482, 8488, 8495, 8502, 8508, 8514, 8521, 8527, 8534, 8540, 8546, 8553, 8559, 8566, 8573, 8579, 8586, 8592, 8599, 8605, 8612, 8618, 8625, 8632, 8638, 8645, 8652, 8658, 8664, 8671, 8677, 8684, 8691, 8697, 8710, 8723, 8730, 8744, 8750, 8757, 8764, 8776, 8782, 8788, 8795, 8802, 8808, 8821, 8828, 8835, 8861, 8881, 8888, 8919, 8970, 8996, 9002, 9015, 9022, 9035, 9041, 9048, 9054, 9060, 9073, 9087, 9094, 9107, 9113, 9120, 9132, 9139, 9146, 9153, 9159, 9166, 9173, 9180, 9186, 9192, 9199, 9205, 9212, 9219, 9226, 9233, 9239, 9246, 9252, 9259, 9265, 9272, 9278, 9285, 9291, 9298, 9305, 9311, 9318, 9325, 9332, 9338, 9344, 9351, 9358, 9365, 9372, 9378, 9384, 9391, 9397, 9403, 9410, 9417, 9423, 9429, 9436, 9443, 9449, 9455, 9462, 9469, 9476, 9482, 9488, 9495, 9514, 9521, 9534, 9546, 9565, 9598, 9618, 9624, 9631, 9650, 9657, 9696, 9703, 9709, 9722, 9736, 9763, 9770, 9777, 9797, 9817, 9837, 9850, 9857, 9863, 9870, 9877, 9883, 9889, 9896, 9909, 9930, 9955, 9982, 9989, 10008, 10015, 10054, 10061, 10067, 10073, 10079, 10086, 10105, 10118, 10125, 10132, 10144, 10157, 10164, 10189, 10202, 10216, 10229, 10235, 10242, 10248, 10255, 10261, 10268, 10274, 10280, 10287, 10294, 10301, 10342, 10349, 10363, 10370, 10376, 10383, 10390, 10397, 10404, 10425, 10432, 10438, 10445, 10452, 10459, 10466, 10473, 10480, 10487, 10500, 10507, 10514, 10521, 10528, 10535, 10542, 10549, 10556, 10562, 10569, 10576, 10583, 10590, 10597, 10604, 10625, 10632, 10653, 10660, 10702, 10709, 10735, 10742, 10748]


strings = MAINSTAT_KEY_STRINGS.keys()

def drawText(text):
	## load font
	fontPath = "./zh-cn.ttf"     
	fontSize = 18 ## determined experimentally
	font = ImageFont.truetype(fontPath, fontSize)
	## create canvas
	img = np.zeros((18, 199), np.uint8)
	img_pil = Image.fromarray(img)
	## draw text
	draw = ImageDraw.Draw(img_pil)
	draw.text((1, 0), text, font = font, fill = 255)
	img = np.array(img_pil)
	#cv.imwrite('t.png', img)
	return img

#i = drawText('ATK')
#cv.imshow('test', i)
#cv.waitKey()

def binarize(img):
	x = cv.cvtColor(img, cv.COLOR_BGR2GRAY)
	_, x = cv.threshold(x, 128, 255, cv.THRESH_BINARY)
	return x


video = cv.VideoCapture('2023-01-15 17-48-41.mp4')
for f in frame:
	i = getFrame(video, f)
	fontVec = (167, 173, 195, 255)
	mainStatRegion2 = (1368, 253, 205, 18)
	mainStatRegion = (1362, 253, 199, 30)
	y = crop(i, mainStatRegion2)
	x = crop(i, mainStatRegion)
	#x = cv.cvtColor(x, cv.COLOR_BGR2GRAY)
	#_, x = cv.threshold(x, 128, 255, cv.THRESH_BINARY)
	txt = pytesseract.image_to_string(x).strip()
	txt2 = pytesseract.image_to_string(y).strip()
	txt = txt.strip()
	cv.imshow('x', x)
	cv.imshow('y', y)
	print(f'x: {txt}')
	print(f'y: {txt2}')
	cv.waitKey(10)
	#x = cv.cvtColor(x, cv.COLOR_BGR2GRAY)
	#cv.imwrite('tt.png', x)
	#cv.imshow('x', x)
	#drawn = drawText('ATK')
	#d = cv.absdiff(x, drawn)
	#_, ex = cv.threshold()
	#cv.imshow('diff', d)
	#cv.waitKey()
	#exit()

#viewFrame(video, 280)